# patterns/02 review

## 今回の問題点

- `free / pro / enterprise` ごとの分岐が複数メソッドに重複していた
- 画面表示、送信処理、説明文、ボタン色などで同じ条件分岐を何度も書いていた
- `new Xxx...` が各所に散らばり、生成ロジックが一元管理されていなかった
- プランを1つ追加するだけで、複数箇所の修正が必要だった

## 変更に弱かった理由

- 「どのプランで何を使うか」の知識が Controller に集中していた
- プラン固有の差分が、分岐として横に広がっていた
- 生成と利用が混ざっていて、責務境界が曖昧だった

## どう解決するべきだったか

- プランごとの責務を `Provider` に分離する
- 共通契約を `PlanBaseProvider` として定義し、利用側を統一する
- Controller は `selectedPlan -> provider` の解決と呼び出しだけに絞る
- 生成の入口を1か所（`planBundles`）に集約する

## 今回の実装で得られた効果

- 条件分岐の重複が減り、可読性が上がった
- プラン追加の影響範囲が小さくなった
- `student` 追加時に、既存メソッドの大規模修正なしで対応できた

## 実務での判断基準

- 分岐が「種類ごとの差分」だけを表しているなら、分岐をオブジェクトへ移す
- 同じ分岐が3回以上出てきたら、生成責務の分離を検討する
- 新種追加の手順が「新クラス追加 + マップ登録」で終わる形を目指す
